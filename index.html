<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hoy Voy Time Tracker</title>
  <style>
    @font-face {
      font-family: 'ProximaNovaCondBlack';
      src: url('fonts/ProximaNovaCondBlack.woff2') format('woff2');
    }
    @font-face {
      font-family: 'DINRoundPro';
      src: url('fonts/DINRoundPro.woff') format('woff');
    }
    * {
      font-family: 'DINRoundPro', sans-serif;
      box-sizing: border-box;
    }
    body {
      margin: 2rem;
      background: #f9f9f9;
      color: #1c1c1c;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 4px solid #000;
      padding-bottom: 1rem;
      margin-bottom: 2rem;
    }
    header img {
      height: 50px;
    }
    h1 {
      font-family: 'ProximaNovaCondBlack', sans-serif;
      font-size: 1.5rem;
      color: #000;
    }
    .task {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
    }
    .task input[type="text"] {
      flex: 1;
      padding: 0.3rem;
      border: 1px solid #000;
      border-radius: 4px;
      background-color: #fff;
    }
    .task-time {
      width: 90px;
      text-align: center;
      font-variant-numeric: tabular-nums;
      padding: 0.3rem;
      border: 1px solid #000;
      border-radius: 4px;
      background: #fff;
    }
    button {
      padding: 0.3rem 0.6rem;
      cursor: pointer;
      background-color: #000;
      color: #fff200;
      border: none;
      border-radius: 4px;
      font-weight: bold;
    }
    #total {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
      color: #000;
    }
    #modal-bg, #confirm-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #modal, #confirm-box {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    #modal h2, #confirm-box p {
      margin-top: 0;
      font-family: 'ProximaNovaCondBlack';
    }
    #modal input {
      width: 100%;
      padding: 0.5rem;
      margin-top: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #000;
      border-radius: 4px;
    }
    #modal-buttons, #confirm-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Hoy Voy Time Tracker</h1>
    <img src="hoy-voy-logodibuixat-01-col.png" alt="Logo Hoy Voy" />
  </header>

  <div id="task-list"></div>
  <button id="addBtn">+ AÃ±adir tarea</button>
  <button onclick="exportCSV()">â†“ Exportar CSV</button>
  <button onclick="openConfirm()">ðŸ—‘ Borrar todo</button>
  <div id="total">Total: 00:00:00</div>

  <div id="modal-bg">
    <div id="modal">
      <h2 id="modal-title">Nueva tarea</h2>
      <input type="text" id="modal-input" placeholder="Nombre de la tarea" />
      <input type="text" id="modal-time" placeholder="Tiempo (opcional, hh:mm:ss)" />
      <div id="modal-buttons">
        <button id="cancelBtn">Cancelar</button>
        <button id="confirmBtn">Aceptar</button>
      </div>
    </div>
  </div>

  <div id="confirm-bg">
    <div id="confirm-box">
      <p>Â¿Seguro que quieres borrar todas las tareas?</p>
      <div id="confirm-buttons">
        <button onclick="closeConfirm()">Cancelar</button>
        <button onclick="confirmClear()">Aceptar</button>
      </div>
    </div>
  </div>

  <script>
    let tasks = [];
    let editingIndex = null;

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('addBtn').addEventListener('click', () => openModal());
      document.getElementById('confirmBtn').addEventListener('click', confirmModal);
      document.getElementById('cancelBtn').addEventListener('click', closeModal);
      document.getElementById('modal-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') confirmModal();
      });
      document.getElementById('modal-time').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') confirmModal();
      });
    });

    function openModal(index = null) {
      editingIndex = index;
      document.getElementById('modal-title').textContent = index === null ? 'Nueva tarea' : 'Editar tarea';
      document.getElementById('modal-input').value = index === null ? '' : tasks[index].name;
      document.getElementById('modal-time').value = index === null ? '' : tasks[index].time;
      document.getElementById('modal-bg').style.display = 'flex';
      setTimeout(() => document.getElementById('modal-input').focus(), 100);
    }

    function closeModal() {
      document.getElementById('modal-bg').style.display = 'none';
    }

    function confirmModal() {
      const name = document.getElementById('modal-input').value.trim();
      const time = document.getElementById('modal-time').value.trim();
      if (!name) return;

      if (editingIndex === null) {
        tasks.push({ name, time: time || '00:00:00', seconds: timeToSeconds(time || '00:00:00') });
      } else {
        tasks[editingIndex].name = name;
        if (time) {
          tasks[editingIndex].time = time;
          tasks[editingIndex].seconds = timeToSeconds(time);
        }
      }
      closeModal();
      saveTasks();
    }

    function timeToSeconds(t) {
      const parts = t.split(':').map(Number);
      return (parts[0] || 0) * 3600 + (parts[1] || 0) * 60 + (parts[2] || 0);
    }

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      location.reload();
    }

    function openConfirm() {
      document.getElementById('confirm-bg').style.display = 'flex';
    }
    function closeConfirm() {
      document.getElementById('confirm-bg').style.display = 'none';
    }
    function confirmClear() {
      tasks = [];
      saveTasks();
      closeConfirm();
    }
  </script>
</body>
</html>
